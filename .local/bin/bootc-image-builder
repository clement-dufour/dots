#!/usr/bin/env bash

set -euo pipefail
# set -x

container_image="${1}"
shift

truncate disk.raw --size 4G

sudo podman run \
    --rm \
    -it \
    --privileged \
    --pull=newer \
    --security-opt label=type:unconfined_t \
    --volume ./disk.raw:/disk.raw \
    --pid=host \
    "${container_image}" \
    bootc install to-disk --via-loopback '/disk.raw' --generic-image "${@}"
